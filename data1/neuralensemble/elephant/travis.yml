dist: xenial
language: python
sudo: false

   apt:
     update: true


matrix:
  include:
    - name: "conda 3.6 extras,opencl"
        - conda install -c conda-forge pyopencl oclgrind clang=9.0.1
        - pip install -r requirements/requirements-extras.txt
        - pip install mpi4py
      script: mpiexec -n 1 python -m mpi4py.futures -m pytest --cov=elephant
      after_success: coveralls || echo "coveralls failed"

    - name: "conda 3.7"
        - pip install -r requirements/requirements-tutorials.txt
        - pip install -r requirements/requirements-extras.txt
        - pip install mpi4py
        - sed -i -E "s/nbsphinx_execute *=.*/nbsphinx_execute = 'always'/g" doc/conf.py
      script: cd doc && make html

  - pip install -r requirements/requirements-tests.txt
  - pip install pytest-cov coveralls
  - python setup.py install
  - python -c "from elephant.spade import HAVE_FIM; assert HAVE_FIM"
  - pip list
  - python --version

script:
  pytest --cov=elephant